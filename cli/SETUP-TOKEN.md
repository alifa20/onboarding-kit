# Setup Token Authentication

OnboardKit uses **Claude Code setup tokens** to authenticate with your Claude Pro/Max subscription.

## Why Setup Tokens?

- âœ… **Uses your Claude subscription** ($20-200/month flat rate)
- âœ… **No API charges** - no per-token billing
- âœ… **Long-lived tokens** - generated by official Claude Code CLI
- âœ… **Secure** - stored in OS keychain

## Prerequisites

1. **Claude Pro or Claude Max subscription**
   - Free tier will NOT work
   - Subscribe at: https://claude.ai/subscription

2. **Claude Code CLI installed**
   ```bash
   # macOS
   brew install anthropics/claude-code/claude

   # Or download from:
   # https://claude.com/download
   ```

## Quick Start

### Step 1: Generate Setup Token

Run the Claude Code CLI command to generate a setup token:

```bash
claude setup-token
```

This will:
1. Open your browser to claude.ai
2. Prompt you to log in with your Claude Pro/Max account
3. Generate a long-lived OAuth token
4. Display the token (starts with `sk-ant-oat01-...`)

**Copy the entire token** - you'll need it in the next step.

### Step 2: Authenticate OnboardKit

```bash
npx onboardkit auth
```

When prompted, paste your setup token:
```
? Enter your Claude Code setup token: sk-ant-oat01-xxxxxxxxxxxxx...
```

OnboardKit will:
1. Validate the token
2. Save it securely to your OS keychain
3. Confirm successful authentication

### Step 3: Use OnboardKit

```bash
npx onboardkit onboard spec.md --output ./my-app
```

All AI features will use your Claude subscription - no additional charges!

## How It Works

### Architecture

```
You
  â†“
Claude Code CLI (official)
  â†“ [claude setup-token]
Browser â†’ claude.ai â†’ Authenticate
  â†“
Long-lived OAuth token (sk-ant-oat01-...)
  â†“ [copy/paste]
OnboardKit
  â†“ [stores in keychain]
  â†“ [uses for AI operations]
api.githubcopilot.com (Claude Code API)
  â†“
Claude Pro/Max subscription
```

### Why This Works

1. **Official OAuth Flow**: Claude Code CLI has the official `client_id` needed for OAuth
2. **Pre-authenticated Token**: The token is already authenticated by Anthropic
3. **Proxy Pattern**: OnboardKit uses the token to access Claude Code API
4. **No Third-Party OAuth**: We don't implement OAuth - we use official tokens

### Token Details

- **Format**: `sk-ant-oat01-` prefix
- **Lifetime**: Long-lived (weeks/months)
- **Storage**: OS keychain (macOS Keychain, Windows Credential Store, Linux Secret Service)
- **Fallback**: Encrypted file at `~/.onboardkit/credentials.json`
- **Scope**: Full Claude Code API access

## Commands

### Authenticate
```bash
npx onboardkit auth
```
Prompts for setup token and saves it securely.

### Check Status
```bash
npx onboardkit auth status
```

Example output:
```
â”Œ  Authentication Status
â”‚
â”‚  âœ“ Claude Pro/Max Setup Token
â”‚    Status: Authenticated
â”‚    Mode: Subscription (no API charges)
â”‚    Token: sk-ant-oat01-j4CFlKo...
â”‚    Type: Claude Code setup token
â”‚
â””  Status check complete
```

### Revoke
```bash
npx onboardkit auth revoke
```
Removes stored token from keychain.

## Troubleshooting

### "Token hasn't expired but fails"

Setup tokens can be revoked or invalidated. Regenerate:
```bash
claude setup-token --force
npx onboardkit auth
```

### "Failed to validate setup token"

**Check these:**
1. âœ“ Token copied completely (no extra spaces/newlines)
2. âœ“ You have Claude Pro or Claude Max (not free tier)
3. âœ“ Claude Code CLI is up to date: `brew upgrade claude`
4. âœ“ Token starts with `sk-ant-oat01-`

### "Claude Code CLI not found"

Install it:
```bash
# macOS
brew install anthropics/claude-code/claude

# Verify installation
claude --version
```

### "Invalid token format"

Setup tokens must:
- Start with `sk-ant-oat01-`
- Be generated by `claude setup-token` (not console.anthropic.com)
- Be from Claude Pro/Max account (not free tier)

### Token expired

Regenerate with:
```bash
claude setup-token --force
```

Then re-authenticate OnboardKit:
```bash
npx onboardkit auth
```

## Cost Comparison

### With Setup Token (Recommended)
- **Claude Pro**: $20/month flat
  - Unlimited onboard runs (rate limited)
  - No per-token charges

- **Claude Max**: $200/month flat
  - 5x higher limits than Pro
  - Priority access
  - No per-token charges

### What You Save

If you already have Claude Pro/Max:
- **$0 additional cost** for OnboardKit
- Use existing subscription
- No surprise bills

## Security

### Token Storage
- **Primary**: OS keychain (encrypted by operating system)
  - macOS: Keychain
  - Windows: Credential Store
  - Linux: Secret Service
- **Fallback**: Encrypted file at `~/.onboardkit/credentials.json`
- **Never**: Plain text or git repositories

### Token Security
- Generated by official Claude Code CLI
- Long-lived but revocable
- Stored encrypted
- Only accessible to OnboardKit

### Best Practices
1. **Never commit tokens** to git repositories
2. **Rotate tokens periodically** with `claude setup-token --force`
3. **Revoke unused tokens** with `npx onboardkit auth revoke`
4. **One token per machine** (don't share across machines)

## Comparison with Other Tools

### OpenClaw
- âœ“ Uses setup tokens
- âœ“ Requires Docker proxy
- Complex setup

### OnboardKit
- âœ“ Uses setup tokens
- âœ“ No Docker required
- âœ“ Direct CLI integration
- Simple setup

## FAQs

**Q: Does this work with Claude free tier?**
A: No, you need Claude Pro ($20/mo) or Claude Max ($200/mo).

**Q: How long do setup tokens last?**
A: Weeks to months. Regenerate when they expire with `claude setup-token --force`.

**Q: Can I use the same token on multiple machines?**
A: Technically yes, but best practice is one token per machine. Generate new tokens with `claude setup-token`.

**Q: Is this against Anthropic's Terms of Service?**
A: No! We use official setup tokens from the official Claude Code CLI. This is the supported way for third-party tools.

**Q: What if I don't want to install Claude Code CLI?**
A: You must install it - there's no other way to get valid setup tokens for Claude Pro/Max access.

**Q: Can tokens be revoked?**
A: Yes. Anthropic can revoke tokens. If this happens, regenerate with `claude setup-token --force`.

**Q: What about rate limits?**
A: Subject to your subscription's rate limits (Pro < Max).

## Resources

- [Claude Code Download](https://claude.com/download)
- [Claude Pricing](https://claude.ai/subscription)
- [Claude Code Documentation](https://code.claude.com/docs)
- [OpenClaw Authentication Docs](https://docs.openclaw.ai/providers/anthropic)

## Support

If you encounter issues:

1. **Check status**: `npx onboardkit auth status`
2. **Regenerate token**: `claude setup-token --force`
3. **Re-authenticate**: `npx onboardkit auth`
4. **Report issues**: https://github.com/[your-repo]/issues

---

**Ready to get started?**

1. Install Claude Code CLI
2. Run `claude setup-token`
3. Run `npx onboardkit auth`
4. Start building! ðŸš€
